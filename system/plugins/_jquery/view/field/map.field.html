<!-- load up map.js -->
<script src="//maps.google.com/maps/api/js?sensor=true"></script>
<script src="{{baseurl}}system/js/gmap/gmap-0.3.2.js"></script>
<style>
/** Maps fixes for bootstrap **/
#map_basemap img {
  max-width: none;
}
#map_basemap label {
  width: auto; display:inline;
}
</style>

<input type="hidden" name="{{field.name}}[lat]" value="{{field.value.lat}}">
<input type="hidden" name="{{field.name}}[lng]" value="{{field.value.lng}}">

<!-- display a map with current location -->
<div class="map" id="map_{{field.uid}}"></div>
<script>
	zaj.ready(function(){
		var e = document.getElementById('map_{{field.uid}}');
		if(e.offsetHeight == 0) e.style.height = '300px';
	});
	var map_{{field.uid}} = new GMaps({
		div: '#map_{{field.uid}}',
		zoom: 14,
		lat: {% if field.value.lat %}{{field.value.lat}}{% elseif %}47.497912{% endif %},
	lng: {% if field.value.lng %}{{field.value.lng}}{% elseif %}19.040235{% endif %},
		scrollwheel: false,
				click: function(e) {
			// set new input values
			$('input[name="{{field.name}}[lat]"]')[0].value = e.latLng.jb;
			$('input[name="{{field.name}}[lng]"]')[0].value = e.latLng.kb;
			// set marker position
			map_{{field.uid}}.removeMarkers();
			map_{{field.uid}}.addMarker({
				lat: e.latLng.jb,
				lng: e.latLng.kb,
			});
		},
		dragend: function(e) {
		}
	});
	{% if field.value.lat and field.value.lng %}
	// set marker position
	map_{{field.uid}}.removeMarkers();
	map_{{field.uid}}.addMarker({
		lat: {{field.value.lat}},
		lng: {{field.value.lng}},
	});
	{% endif %}

	{% if field.options.geolocation and not field.value.lat %}
	GMaps.geolocate({
		success: function(position) {
			map_{{field.uid}}.setCenter(position.coords.latitude, position.coords.longitude);
		},
		error: function(error) {
		},
		not_supported: function() {
		},
		always: function() {
		}
	});
	{% endif %}
	var map_editor_field = map_{{field.uid}};
</script>